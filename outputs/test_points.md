# req.md

## 一、客户搜品约定配置管理

### 1️⃣ 展示与交互

客户编号筛选框支持0~50字符输入，超长时截断或禁输

重置按钮恢复所有筛选项为默认值（客户编号为空）

搜索按钮触发按客户编号精准匹配查询

新增按钮弹出配置弹窗，含客户编号、搜品类型、客户约定三字段

编辑按钮弹窗预填充原值，且客户编号不可修改（仅搜品类型+约定内容可改）

删除按钮触发二次确认弹窗，文案为‘确定要删除该配置吗？’

列表中客户名称、账户经理、搜品类型、约定内容字段均实时展示

### 2️⃣ 校验逻辑

客户编号必填且1~50字符，空值/超长提交时前端拦截并提示

搜品类型下拉枚举值严格限定为8种：不完整订单搜品、店铺搜品、个人搜品、个人搜品-付费、店铺搜品-付费、插件搜品、api搜品、线下搜品

客户约定内容必填且1~500字符，空值/超长提交时前端拦截并提示

同一客户编号+同一搜品类型组合不允许重复创建（后端唯一性约束）

编辑时客户编号字段置灰不可编辑，防止变更主键导致映射错乱

删除操作需校验该配置是否被当前任何搜品流程引用（如已引用则禁止删除）

⚠️ 边界点

- 客户编号输入50字符时，提交成功；输入51字符时前端应截断或报错

⚠️ 异常点

- 客户编号含SQL注入特征字符（如' OR '1'='1）时，前端应过滤或后端应参数化防注入

### 3️⃣ 数据一致性

账户经理字段必须实时调用客户主数据接口获取，非缓存值

客户名称与客户编号须来自同一客户主数据记录，禁止拼接或错位展示

新增/编辑后列表刷新，确保新配置立即可见且排序符合预期（如按客户编号升序）

删除后列表实时移除对应行，无残留或错位

⚠️ 隐藏雷点提示

- 需确认账户经理字段的实时性SLA要求（如TTL≤5s），否则存在数据滞后风险

## 二、SKU匹配审核/待审核/待录入页客户约定展示

### 1️⃣ 展示逻辑

页面‘客户约定’字段位置固定在客户商品信息区域下方

当存在该客户编号+搜品类型的约定时，展示约定内容且字体为红色

当不存在对应约定时，展示‘--’（两个短横线，非空格或破折号）

红色字体需兼容色弱模式，提供足够对比度（≥4.5:1）

### 2️⃣ 匹配准确性

匹配依据为当前页面上下文中的客户编号 + 当前搜品流程类型（如‘不完整订单搜品’）

搜品类型枚举值必须与配置模块完全一致，大小写/中英文符号零误差

客户编号若含前后空格，匹配前需trim处理，避免‘ABC ’≠‘ABC’

⚠️ 隐藏雷点提示

- 需确认SKU匹配页中‘搜品类型’字段来源（前端传参？后端推导？），若未显式透传则无法准确匹配约定

## 三、无图搜品/搜品再搜品/搜品成功/搜品失败页客户约定展示

### 1️⃣ 展示位置与样式

客户约定信息固定展示于客户商品详情区块正下方，不遮挡关键字段

有约定时红色字体，无约定时显示‘--’，样式与SKU匹配页完全一致

多语言环境下‘--’需保持统一，不翻译

### 2️⃣ 流程覆盖完整性

无图搜品页：展示当前客户编号+当前搜品类型（如‘插件搜品’）的约定

搜品再搜品页：沿用原始搜品请求的客户编号+搜品类型，非新发起流程的类型

搜品成功页：约定内容需在商品入库前即展示，支撑人工复核

搜品失败页：仍需展示约定，便于分析失败是否与约定冲突（如‘不需要供应商商品’但返回了供应商信息）

⚠️ 隐藏雷点提示

- 需确认‘搜品再搜品’是否复用原始客户编号+搜品类型，若流程重建则可能丢失上下文

## 四、权限与并发风险

### 1️⃣ 权限控制

客户约定配置的新增/编辑/删除仅对管理员和账户经理角色开放

普通搜品人员仅可见展示，不可见配置入口及操作按钮

账户经理仅可编辑/删除自己名下客户的约定配置（基于账户经理字段鉴权）

### 2️⃣ 并发编辑

同一客户编号+搜品类型被两人同时编辑时，后提交者应提示‘数据已被他人修改，请刷新后重试’

编辑弹窗加载时读取最新版本号（ETag或update_time），提交时校验未变更

⚠️ 隐藏雷点提示

- 需确认客户约定配置表是否具备乐观锁机制（如version字段），否则存在覆盖写风险

## 五、性能与容量风险

### 1️⃣ 查询性能

客户约定配置列表页支持10万级配置数据量，搜索响应≤1s

各搜品流程页加载客户约定时，查询耗时≤200ms（含跨服务调用）

账户经理字段实时查询不得引发客户主数据服务雪崩（需熔断/降级）

⚠️ 隐藏雷点提示

- 需确认客户约定配置是否建立复合索引（customer_id + search_type），否则大数据量下查询慢
